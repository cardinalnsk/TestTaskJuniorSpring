# Сервис Мобильных Платежей

Простое приложение на Spring Boot для имитации оплаты услуг мобильной связи.

## Обзор

Приложение предоставляет набор HTTP-методов для обработки запросов от внешних клиентов, таких как Postman, wget, curl и т.д. В нем реализованы функции регистрации пользователя, запроса баланса и обработки платежей. Вся информация о пользователях хранится в базе данных.

## Функционал

### Основная часть

- **Регистрация пользователя**: Единственный метод, доступный без авторизации. Все остальные HTTP-методы требуют базовой авторизации. В качестве логина используется номер телефона. После регистрации на счет пользователя зачисляется 1000 рублей. 
В случае успешной регистрации возвращается объект, вида: 
   ```json
      {
        "userId": 1,
        "phoneNumber": "+1234567890",
        "balance": 1000,
        "token": "Basic KzEyMzQ1Njc4OTA6cGFzc3dvcmQ="
      }
   ```

- **Получение баланса**: Возвращает текущий баланс и логин пользователя на основе авторизационных данных.
Обязательно передать ``Authorization: Basic {BasicAuthorizationToken}``
В случае верных авторизационных данных возвращается объект типа:
   ```json
      {
        "phoneNumber": "+1234567890",
        "amount": 1000
      }
    ```
  

- **Оплата**: Принимает номер телефона и сумму платежа (с копейками). Если на счету пользователя достаточно средств, сумма списывается, и возвращается ответ об успешной оплате. Информация о платеже сохраняется в базе данных.

### Дополнительная часть

- **Редактирование данных пользователя**: Пользователи могут создавать или обновлять свои ФИО, email, пол и дату рождения.

- **История операций**: Возвращает список платежей, выполненных пользователем. Включает ID операции, телефон, сумму и дату. Реализована пагинация метода.

- **Юнит-тесты**: Покрытие реализованного функционала тестами.

## Начало работы

Для запуска приложения вам понадобится Java и Maven.

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/cardinalnsk/TestTaskJuniorSpring.git
    ```
2. Перейдите в директорию проекта:
   ```bash
   cd TestTaskJuniorSpring
    ```
3. Соберите проект с помощью Maven:
   ```bash
   mvn clean install
    ```
4. Запустите приложение:
   ```bash
   mvn spring-boot:run
    ```
Приложение запустится и будет доступно по адресу http://localhost:8089.

### Docker Compose

В проекте есть `docker-compose.yml` файл, который настраивает и запускает базу данных PostgreSQL для приложения.

Чтобы запустить базу данных, выполните следующую команду:
```bash
docker-compose up -d
```

### Миграции Базы Данных с Flyway

Миграции базы данных выполняются автоматически при старте приложения с использованием инструмента Flyway. Это обеспечивает версионирование схемы базы данных и её эволюцию вместе с приложением.

## API Эндпоинты

Доступны следующие эндпоинты:

- `POST /api/auth/register` - Регистрация нового пользователя.
- `GET /api/current-balance` - Получение текущего баланса авторизованного пользователя.
- `POST /api/pay-phone` - Совершение платежа.

Для дополнительной части:

- `GET /api/user` - Получение пользовательских данных.
- `PUT /api/user` - Обновление пользовательских данных.
- `GET /api/history` - Получение списка транзакций пользователя с пагинацией.
