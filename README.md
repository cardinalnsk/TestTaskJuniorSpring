# Сервис Мобильных Платежей

Простое приложение на Spring Boot для имитации оплаты услуг мобильной связи.

## Используемые технологии

### Spring Boot
- SpringWeb: Для создания веб-приложений, включая RESTfull приложения, используя Spring MVC.
- Spring-Devtools: Предоставляет быструю перезагрузку приложения и другие удобства для разработки.
- Spring-AOP: Поддержка аспектно-ориентированного программирования, включая интеграцию с AspectJ.
- Spring-Security: Предоставляет аутентификацию и авторизацию для защиты приложения.

### База данных и персистентность
- Flyway: Инструмент для управления миграциями базы данных.
- Spring-data-JPA: Поддержка персистентности, используя Spring Data JPA с Hibernate.

### Утилиты
- Lombok: Утилита для автоматического генерирования кода для стандартных методов, таких как getters, setters, equals, hashCode и toString.
- Spring-Validation: Поддержка валидации с использованием аннотаций из JSR-303.
- Mapstruct: Инструмент для генерирования реализаций мапперов на основе аннотаций, предназначен для маппинга между различными объектами Java.

### Тестирование
- Spring-test: Поддержка тестирования Spring Boot приложений с JUnit, Spring Test и Mockito.
- Mockito: Интеграция Mockito с JUnit 5 для создания моков и шпионов в тестах.

### Документация API
- Springdoc-OpenApi: Интеграция Spring Boot с OpenAPI 3 для автоматического создания документации API и предоставления пользовательского интерфейса Swagger.


## Обзор

Приложение предоставляет набор HTTP-методов для обработки запросов от внешних клиентов, таких как
Postman, wget, curl и т.д. В нем реализованы функции регистрации пользователя, запроса баланса и
обработки платежей. Вся информация о пользователях хранится в базе данных.

## Функционал

### Основная часть

- **Регистрация пользователя**: Единственный метод, доступный без авторизации. Все остальные
  HTTP-методы требуют базовой авторизации. В качестве логина используется номер телефона. После
  регистрации на счет пользователя зачисляется 1000 рублей.

- **Получение баланса**: Возвращает текущий баланс и логин пользователя на основе авторизационных
  данных.
  Обязательно передать ``Authorization: Basic {BasicAuthorizationToken}``


- **Оплата**: Принимает номер телефона и сумму платежа (с копейками). Если на счету пользователя
  достаточно средств, сумма списывается, и возвращается ответ об успешной оплате. Информация о
  платеже сохраняется в базе данных.

### Дополнительная часть

- **Редактирование данных пользователя**: Пользователи могут создавать или обновлять свои ФИО,
  email, пол и дату рождения.

- **История операций**: Возвращает список платежей, выполненных пользователем. Включает ID операции,
  телефон, сумму и дату. Реализована пагинация метода.

- **Юнит-тесты**: Покрытие реализованного функционала тестами.

## Начало работы

Для запуска приложения вам понадобится Java и Maven.

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/cardinalnsk/TestTaskJuniorSpring.git
    ```
2. Перейдите в директорию проекта:
   ```bash
   cd TestTaskJuniorSpring
    ```
3. Соберите проект с помощью Maven:
   ```bash
   mvn clean install
    ```
4. Запустите приложение:
   ```bash
   mvn spring-boot:run
    ```

Приложение запустится и будет доступно по адресу http://localhost:8089.

### Docker Compose

В проекте есть `docker-compose.yml` файл, который настраивает и запускает базу данных PostgreSQL для
приложения.

Чтобы запустить базу данных, выполните следующую команду:

```bash
docker-compose up -d
```

### Миграции Базы Данных с Flyway

Миграции базы данных выполняются автоматически при старте приложения с использованием инструмента
Flyway. Это обеспечивает версионирование схемы базы данных и её эволюцию вместе с приложением.

## API Эндпоинты

Доступны следующие эндпоинты:

- `POST /api/auth/register` - Регистрация нового пользователя.
    ```json
        {
            "firstName": "Иван",
            "phoneNumber": "+79123456789",
            "password": "securePassword123"
        }
    ```
    RESPONSE 200 OK:
   ```json
      {
        "userId": 1,
        "phoneNumber": "+79123456789",
        "balance": 1000,
        "token": "Basic ..."
      }
   ```

- `GET /api/current-balance` - Получение текущего баланса авторизованного пользователя.
    ```json
          {
            "phoneNumber": "+1234567890",
            "amount": 1000
          }
    ```
- `POST /api/pay-phone` - Совершение платежа.
    ```json
      {
          "phoneNumber": "+79123456789",
          "amount": 150.50
      }
  ```

Для дополнительной части:

- `GET /api/user` - Получение пользовательских данных.
- `PUT /api/user` - Обновление пользовательских данных.
    ```json
      {
        "firstName": "Иван",
        "lastName": "Иванов",
        "email": "ivan@ivanov.ru",
        "birthday": "2000-05-01",
        "gender": "MALE"
      }
    ```
- `GET /api/history` - Получение списка транзакций пользователя с пагинацией.
